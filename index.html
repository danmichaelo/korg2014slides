<!DOCTYPE html>

<meta charset="utf-8">
<title>Wikidata : ustrukturert tilnærming til strukturerte data</title>


<section>
    <iframe src="https://wikistream.wmflabs.org/" scrolling="no" style="width:100%; height:100%; overflow:hidden;"></iframe>
    <footer>
      <a href="https://wikistream.wmflabs.org">https://wikistream.wmflabs.org</a>
    </footer>
</section>

<section>
  <h1>Wikidata
    <div style="font-size:60%;">
      ustrukturert tilnærming til strukturerte data
    </div>
  </h1>
  <p style="text-align:center; font-size:80%;">
    Lars Jynge Alvik (NB)<br>
    Dan Michael O. Heggø (UBO)<br>
    2014-05-20
  </p>
</section>


<section>
  <h2 style="margin:100px 50px; font-size:120%;">
    "if there’s anyone who loves a well-structured footnote better than Wikipedians it’s reference librarians, so ... we wanted to find a way to work together that was mutually beneficial and in accordance with our respective missions."
  </h2>
  <footer>
      Liam Wyatt<br> 
      <small>
        <a href="https://en.wikipedia.org/wiki/Wikipedia:Wikipedia_Signpost/2014-05-14/News_and_notes">
          "Ask a librarian'—connecting Wikimedians with the National Library of Australia"
        </a><br>
        <em>The Signpost</em> 14. mai 2014
      </small>
  </footer>
</section>


<section>
  <p>
    Tradisjonell kunnskapsorganisasjon på Wikipedia:
  </p>
  <h2>Kategorier</h2>  
</section>


<section>
  <img src="assets/kategoritre-ibsen-sup2.png" style="width: 100%; margin-top:30px; overflow:hidden;">
  <hr>
  <img src="assets/kategoritre-ibsen-sub.png" style="width: 100%; margin-top:50px;">
  <footer>
    <a href="https://toolserver.org/~dapete/catgraph/graph.php?wiki=wikipedia&amp;lang=no&amp;cat=Henrik_IBsen&amp;d=2&amp;n=0&amp;format=png&amp;links=0&amp;sub=0">
      https://toolserver.org/~dapete/catgraph/
    </a>
  </footer>
</section>


<section>
  <img src="assets/kategorier-ibsen-enwp.png" style="width: 100%; margin-top:100px;">
  <img src="assets/kategorier-ibsen-dewp.png" style="width: 100%; margin-top:100px;">
  <footer>
    Henrik Ibsen kategorisert på hhv. engelsk og tysk Wikipedia
  </footer>
</section>


<section>
  <!--<iframe src="https://tools.wmflabs.org/catscan2/catscan2.php" frameborder="0" style="width:100%; height:100%; overflow:hidden;"></iframe>-->
    <footer>
      <a href="https://tools.wmflabs.org/catscan2/catscan2.php">
        https://tools.wmflabs.org/catscan2/catscan2.php
      </a>
    </footer>
</section>


<section>
  <img src="assets/kategoritre-ibsen-sup2.png" style="width: 100%; margin-top:100px;">
  <hr>
  <img src="assets/kategoritre-ibsen-sub.png" style="width: 100%; margin-top:50px;">
  <footer>
    <a href="https://toolserver.org/~dapete/catgraph/graph.php?wiki=wikipedia&amp;lang=no&amp;cat=Henrik_IBsen&amp;d=2&amp;n=0&amp;format=png&amp;links=0&amp;sub=0">
      https://toolserver.org/~dapete/catgraph/
    </a>
  </footer>
</section>


<section>
  <img src="assets/kategoritre-commons.png" style="width: 70%; display:block;margin:50px auto;">
    <footer>
      <a href="https://commons.wikimedia.org/wiki/Category:People_with_camels_in_art_of_India?uselang=nb">Category:People with camels in art of India</a>
    </footer>
</section>


<section>
  <p>
    Tradisjonell kunnskapsorganisasjon(?) på Wikipedia:
  </p>
  <h2>Maler</h2>  
</section>


<section>
  <table>
    <tr>
      <td>
        <img src="assets/infoboks-ibsen-nowp.png" style="height: 600px; margin: 10px;">        
      </td>
      <td valign="top">
        <img src="assets/infoboks-ibsen-nowp-code.png" style="height: 600px; margin: 10px;">        
      </td>
    </tr>
  </table>
  <footer>
    Infoboks forfatter
  </footer>
</section>


<section>
  <table>
    <tr>
      <td>
        <img src="assets/infoboks-doctorwho1.png" style="height: 600px; margin: 10px;">        
      </td>
      <td valign="top">
        <img src="assets/infoboks-doctorwho2.png" style="height: 400px; margin: 10px;">        
      </td>
    </tr>
  </table>
  <footer>
    Infobox Doctor Who book
  </footer>
</section>


<section>
  <img src="assets/maler-kulturminne.png" style="display: block; width: 80%; margin: 50px auto;">
  <footer>
    Mal:Kulturminne
  </footer>
</section>


<section>
  <img src="assets/dbpedia.png" style="display: block; width: 100%;"> 
  <footer>
    <a href="http://dbpedia.org/page/Henrik_Ibsen">      
      http://dbpedia.org/page/Henrik_Ibsen
    </a>
  </footer>
</section>


<section>
  <img src="assets/infobox-ibsen-enwp-code.png" style="display: block; width: 100%;margin-top:30px;">
  <footer>
    Infobox writer
  </footer>
</section>


<section>
  <h2>Wikidata</h2>
  <footer>
    
  </footer>
</section>


<section>
  <img src="assets/wikidatateam.jpg" style="display: block; width: 100%;"> 
  <footer>
    Teamet som utviklet kjernen av Wikidata 2012–2013.<br>
    <small>John Erling Blad, Abraham Taherivand, Tobias Gritschacher, Jeroen De Dauw, Henning Snater, Lydia Pintscher, Daniel Kinzler, Markus Krötzsch, Silke Meyer, Denny Vrandečić, Katie Filbert, Daniel Werner, Jens Ohlig (fltr, photo by Phillip Wilke.</small>
  </footer>
</section>

<!--
<section>
  <img src="assets/wikidata-fase1-fase2.png" style="display: block; width: 80%; margin: 50px auto;"> 
  <footer>
    Innledende utvikling: løse praktiske problemer
  </footer>
</section>
-->

<section>
   <div style="display:none;">Under datamodell</div>
   <h2 style="margin:100px 50px; font-size:120%;">
    "The first goal of Wikidata is to serve actual use cases in Wikipedia, not to enable some form of hypothetical perfection in knowledge representation."
   </h2>
  <footer>
    <a href="https://meta.wikimedia.org/wiki/Wikidata/Notes/Requirements">
      https://meta.wikimedia.org/wiki/Wikidata/Notes/Requirements
    </a>
  </footer>
</section>


<section>
  <iframe src="https://no.wikipedia.org/wiki/Henrik_Ibsen?uselang=nb" frameborder="0" style="width:100%; height:100%; overflow:hidden;"></iframe>
    <footer>
      <a href="https://no.wikipedia.org/wiki/Henrik_Ibsen">
        https://no.wikipedia.org/wiki/Henrik_Ibsen
      </a>
    </footer>
</section>


<section>
  <iframe src="https://www.wikidata.org/wiki/Q36661?uselang=nb" frameborder="0" style="width:100%; height:100%; overflow:hidden;"></iframe>
    <footer>
      <a href="https://www.wikidata.org/wiki/Q36661">
        https://www.wikidata.org/wiki/Q36661
      </a>
    </footer>
</section>


<section>
  <img src="assets/wikidata-utsagn.png" style="display: block; width: 80%; margin: 50px auto;"> 
  <!--
  <hr>
  <img src="assets/folketall-datamodell.png" style="display: block; width: 60%; margin: 30px auto;"> 
  -->
  <footer>
    Utsagn som påstander med referanser
  </footer>
</section>


<section>
   <div style="display:none;">Under datamodell</div>
   <h2 style="margin:100px 50px; font-size:120%;">
     "Wikidata will not be about the truth, but about statements and their references."
   </h2>
  <footer>
    <a href="https://meta.wikimedia.org/wiki/Wikidata/Notes/Requirements">
      https://meta.wikimedia.org/wiki/Wikidata/Notes/Requirements
    </a>
  </footer>
</section>


<section>
  <img src="assets/wikidata-utsagn-kjonn.png" style="display: block; width: 80%; margin: 30px auto;">
  <footer>
    <a href="https://www.wikidata.org/wiki/Q298423">
      https://www.wikidata.org/wiki/Q298423
    </a>
  </footer>
</section>

<!--

-->

<section>
   <div style="display:none;">Under datamodell</div>
   <h2 style="margin:100px 50px; font-size:120%;">
    "Wikidata is a socio-technical system. Instead of trying to be overly intelligent, we rely on the Wikimedia communities."
   </h2>
  <footer>
    <a href="https://meta.wikimedia.org/wiki/Wikidata/Notes/Requirements">
      https://meta.wikimedia.org/wiki/Wikidata/Notes/Requirements
    </a>
  </footer>
</section>


<section>
   <div style="display:none;">Under datamodell</div>
   <h2 style="margin:100px 50px; font-size:120%;">
    "The success of Wikidata is not measured by the amount of data it stores, but by the creation of a healthy community and its usefulness for Wikipedia and other applications."
   </h2>
  <footer>
    <a href="https://meta.wikimedia.org/wiki/Wikidata/Notes/Requirements">
      https://meta.wikimedia.org/wiki/Wikidata/Notes/Requirements
    </a>
  </footer>
</section>


<section>
  <img src="assets/wikidata-newest-properties-2014-04-12.png" style="display: block; width: 60%; margin: 30px auto;"> 
  <footer>
    <a href="https://www.wikidata.org/wiki/Wikidata:Status_updates">
      https://www.wikidata.org/wiki/Wikidata:Status_updates
    </a>
  </footer>
</section>

<!--
<section>
<table>
<tr><td>
    <img src="assets/hierarkisk-del-av.png" style="display: block; width: 80%;"> 
  </td>
  <td>
     <img src="assets/hierarkisk-barn.png" style="display: block; width: 80%"> 
  </td>
   </tr></table>
  <footer>
   Hierarkiske relasjoner
  </footer>
</section>
-->


<!-- 
To hierarkiske egenskaper: instans av og underklasse av 
-->

<!-- Liste over egenskaper ? 
https://www.wikidata.org/wiki/Wikidata:List_of_properties/Generic/nb
-->


<!--
Geokoordinater
<section>
  <iframe src="https://www.wikidata.org/wiki/Q4935045?uselang=nb" frameborder="0" style="width:100%; height:100%; overflow:hidden;"></iframe>
    <footer>
      <a href="https://www.wikidata.org/wiki/Q4935045">
        https://www.wikidata.org/wiki/Q4935045
      </a>
    </footer>
</section>
-->


<section>
  <iframe src="https://www.wikidata.org/wiki/Wikidata:Books_task_force?uselang=nb" frameborder="0" style="width:100%; height:100%; overflow:hidden;"></iframe>
  <footer>
    <a href="https://www.wikidata.org/wiki/Wikidata:Books_task_force">
      https://www.wikidata.org/wiki/Wikidata:Books_task_force
    </a>
  </footer>
</section>


<section>
  <img src="assets/wikidata-books-discussion.png" style="display: block; width: 80%; margin: 30px auto;">  
</section>

<section>
  <img src="assets/maler-viaf.png" style="display: block; width: 80%; margin: 80px auto;">  
  <footer>
    Autoritetskontroll
  </footer>
</section>


<section>
  <img src="assets/elvis.png" style="display: block; width: 100%; margin: 80px auto;">  
  <footer>
    <a href="https://www.wikidata.org/w/index.php?title=Q303&diff=91322168&oldid=91322157">
      https://www.wikidata.org/w/index.php?title=Q303&diff=91322168&oldid=91322157
    </a>
  </footer>
</section>


<section>
   <h2 style="margin:100px 50px; font-size:120%;">
    “While only a small portion of the 600,000 PND records have thus far been linked with their corresponding Wikipedia entries, it nevertheless represents a milestone in the way library authority data are repurposed for non-traditional uses.”
   </h2>
  <footer>
  Lovins.
    <a href="http://catalogingandclassificationquarterly.com/ccq42nr1news.html">
      Cataloging & Classification Quarterly, 42, no. 1, 2006
    </a>
  </footer>
</section>


<section>
    <h3>Autoriteter fra Bibsys autoritetsregister</h3>
    <figure>
      <img src="assets/sru-duplikat.png">
      <figcaption></figcaption>
    </figure>
</section>


<section>
    <h3>Autoriteter fra Bibsys autoritetsregister</h3>
    <figure>
      <img src="assets/bibsys-match.png">
      <figcaption></figcaption>
    </figure>
</section>


<section>
  <ul style="font-size: 80%;">

    <li>
      Referanseartikkel for Wikidata: Denny Vrandečić, Markus Krötzsch. “
      <a href="http://korrekt.org/page/Wikidata:_A_Free_Collaborative_Knowledge_Base">Wikidata: A Free Collaborative Knowledge Base</a>”. I: <em>Communications of the ACM</em> 2014 (preprint).
    </li>

    <li>
      <em><a href="https://www.penflip.com/nichtich/normdaten-in-wikidata">
        Normdaten in Wikidata
      </a></em>, håndbok under produksjon 
      (<a href="http://hshwd.jakobvoss.de/normdaten-in-wikidata-a4.pdf">PDF</a>) 
    </li>

    <li>
      Maximilian Klein, Alex Kyrios.
      “<a href="http://journal.code4lib.org/articles/8964">VIAFbot and the Integration of Library Data on Wikipedia</a>”. I <em>The Code4Lib Journal</em>, 14. oktober 2013.
    </li>

    <li>
      Jake Orlowitz, Patrick Earley.
      “<a href="http://www.thedigitalshift.com/2014/01/discovery/librarypedia-future-libraries-wikipedia/">Librarypedia: The Future of Libraries and Wikipedia.</a>”
      I <em>Library Journal</em>, 25. januar 2014
    </li>

    <li>
      Verktøy for å utforske Wikidata:
      <a href="http://tools.wmflabs.org/reasonator/?q=Q2&lang=nb">Reasonator</a>
    </li>

  </ul>
  <footer>
    Takk! Presentasjonen finnes på http://tiny.cc/korg14
  </footer>
</section>


<!-- Ekstra -->


<section>
  Slekstre-visualisering (finn en feil)
  <footer>
      <a href="https://toolserver.org/~magnus/ts2/geneawiki/?q=Q36661&lang=nb">
        https://toolserver.org/~magnus/ts2/geneawiki/?q=Q36661&lang=nb
      </a>
    </footer>
</section>
<section>
  <!--<iframe src="http://tools.wmflabs.org/reasonator/?&q=36661&lang=nb" frameborder="0" style="width:100%; height:100%; overflow:hidden;"></iframe>-->
    <footer>
      <a href="http://tools.wmflabs.org/reasonator/?&q=36661&lang=nb">
        http://tools.wmflabs.org/reasonator/?&q=36661&lang=nb
      </a>
    </footer>
</section>

<section>
  <!--<iframe src="http://tools.wmflabs.org/reasonator/?&q=2&lang=nb" frameborder="0" style="width:100%; height:100%; overflow:hidden;"></iframe>-->
    <footer>
      <a href="http://tools.wmflabs.org/reasonator/?&q=2&lang=nb">
        http://tools.wmflabs.org/reasonator/?&q=2&lang=nb
      </a>
    </footer>
</section>


<section>
    <img src="assets/ask-a-librarian.png" style="width:100%;">
    <footer>
      <a href="https://en.wikipedia.org/wiki/Wikipedia:Wikipedia_Signpost/2014-05-14/News_and_notes">    https://en.wikipedia.org/wiki/Wikipedia:Wikipedia_Signpost/2014-05-14/News_and_notes
      </a>
    </footer>
</section>


<!--
<section>
    <h3>An incremental list</h3>
    <ul class="incremental">
      <li>Item 1
      <li>Item 2
      <li>Item 3
        <ul class="incremental">
          <li> Item 3.1
          <li> Item 3.2
        </ul>
    </ul>
    <div role="note">Some notes. They are only visible using onstage shell.</div>
</section>

<section>
  <blockquote>
    Who's brave enough to fly into something we all keep calling a death sphere?
  </blockquote>
  <details>
    <p>In the onstage shell, notes scroll rather than overflow:</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla ac dui eu est feugiat lacinia sit amet nec leo. Mauris eu ipsum leo. Nulla mi odio, cursus sed sollicitudin non, fringilla id magna. Suspendisse sit amet posuere elit. Maecenas iaculis, turpis a placerat imperdiet, libero lorem feugiat nisi, nec tincidunt diam nibh sit amet massa. Vestibulum quis adipiscing tellus. Maecenas sollicitudin sodales pulvinar. Donec dui ipsum, bibendum facilisis consequat interdum, tempus ut mauris. Aliquam ut dolor nec odio scelerisque bibendum quis in neque. Aliquam dui dui, pulvinar quis fermentum quis, gravida eu augue. Nunc tristique dolor a urna pulvinar bibendum. Curabitur mollis cursus neque, in scelerisque metus porta non. Donec tempor enim in nibh vestibulum et convallis nisi malesuada. Duis ut lectus sed metus venenatis porttitor id pharetra quam. Suspendisse sapien turpis, ornare in molestie et, gravida eget turpis.
    </p>
  </details>
</section>

<section>
    <h2>Part two</h2>
</section>
-->

<!--
<section>
    <figure> 
      <video src="http://videos-cdn.mozilla.net/brand/Mozilla_Firefox_Manifesto_v0.2_640.webm" poster="http://www.mozilla.org/images/about/poster.jpg"></video>
      <figcaption>A video</figcaption>
    </figure>
</section>

<section>
    <h2>End!</h2>
</section>
-->

<!-- Your Style -->
<!-- Define the style of your presentation -->

<!-- Maybe a font from http://www.google.com/webfonts ? -->
<link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet'>

<style>
  html, .view body { background-color: black; counter-reset: slideidx; }
  body, .view section { background-color: white; border-radius: 12px }
  /* A section is a slide. It's size is 800x600, and this will never change */
  section, .view head > title {
      /* The font from Google */
      font-family: 'Oswald', arial, serif;
      font-size: 30px;
  }

  .view section:after {
    counter-increment: slideidx;
    content: counter(slideidx, decimal-leading-zero);
    position: absolute; bottom: -80px; right: 100px;
    color: white;
  }

  .view head > title {
    color: white;
    text-align: center;
    margin: 1em 0 1em 0;
  }

  h1, h2 {
    margin-top: 80px;
    text-align: center;
    font-size: 60px;
  }
  h3 {
    margin: 60px 0 50px 100px;
  }

  ul {
      margin: 80px 80px;
  }
  ul li {
    margin-top: 20px;
  }
  li > ul {
      margin: 15px 50px;
  }

  p {
    margin: 75px;
    font-size: 40px;
  }

  blockquote {
    height: 100%;
    background-color: black;
    color: white;
    font-size: 60px;
    padding: 50px;
  }
  blockquote:before {
    content: open-quote;
  }
  blockquote:after {
    content: close-quote;
  }

  /* Figures are displayed full-page, with the caption
     on top of the image/video */
  figure {
    background-color: black;
    width: 100%;
  }
  figure > * {
    position: absolute;
  }
  figure > img, figure > video {
    width: 100%;
  }
  figcaption {
    margin: 70px;
    font-size: 50px;
  }

  footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    padding: 20px;
    font-size: 80%;
    text-align: right;
    background-color: rgba(220,220,220,0.8);
    border-top: 1px solid #CCC;
  }

  /* Transition effect */
  /* Feel free to change the transition effect for original
     animations. See here:
     https://developer.mozilla.org/en/CSS/CSS_transitions
     How to use CSS3 Transitions: */
  section {
    -moz-transition: left 400ms linear 0s;
    -webkit-transition: left 400ms linear 0s;
    -ms-transition: left 400ms linear 0s;
    transition: left 400ms linear 0s;
  }
  .view section {
    -moz-transition: none;
    -webkit-transition: none;
    -ms-transition: none;
    transition: none;
  }

  .view section[aria-selected] {
    border: 5px red solid;
  }

  /* Before */
  section { left: -150%; }
  /* Now */
  section[aria-selected] { left: 0; }
  /* After */
  section[aria-selected] ~ section { left: +150%; }

  /* Incremental elements */

  /* By default, visible */
  .incremental > * { opacity: 1; }

  /* The current item */
  .incremental > *[aria-selected] { opacity: 1; }

  /* The items to-be-selected */
  .incremental > *[aria-selected] ~ * { opacity: 0; }

  /* The progressbar, at the bottom of the slides, show the global
     progress of the presentation. */
  #progress-bar {
    height: 2px;
    background: #AAA;
  }
</style>

<!-- {{{{ dzslides core
#
#
#     __  __  __       .  __   ___  __
#    |  \  / /__` |    | |  \ |__  /__`
#    |__/ /_ .__/ |___ | |__/ |___ .__/ core :€
#
#
# The following block of code is not supposed to be edited.
# But if you want to change the behavior of these slides,
# feel free to hack it!
#
-->

<div id="progress-bar"></div>

<!-- Default Style -->
<style>
  * { margin: 0; padding: 0; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
  [role="note"] { display: none; }
  body {
    width: 800px; height: 600px;
    margin-left: -400px; margin-top: -300px;
    position: absolute; top: 50%; left: 50%;
    overflow: hidden;
    display: none;
  }
  .view body {
    position: static;
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    display: inline-block;
    overflow: visible; overflow-x: hidden;
    /* undo Dz.onresize */
    transform: none !important;
    -moz-transform: none !important;
    -webkit-transform: none !important;
    -o-transform: none !important;
    -ms-transform: none !important;
  }
  .view head, .view head > title { display: block }
  section {
    position: absolute;
    pointer-events: none;
    width: 100%; height: 100%;
  }
  .view section {
    pointer-events: auto;
    position: static;
    width: 800px; height: 600px;
    margin: -150px -200px;
    float: left;

    transform: scale(.4);
    -moz-transform: scale(.4);
    -webkit-transform: scale(.4);
    -o-transform: scale(.4);
    -ms-transform: scale(.4);
  }
  .view section > * { pointer-events: none; }
  section[aria-selected] { pointer-events: auto; }
  html { overflow: hidden; }
  html.view { overflow: visible; }
  body.loaded { display: block; }
  .incremental {visibility: hidden; }
  .incremental[active] {visibility: visible; }
  #progress-bar{
    bottom: 0;
    position: absolute;
    -moz-transition: width 400ms linear 0s;
    -webkit-transition: width 400ms linear 0s;
    -ms-transition: width 400ms linear 0s;
    transition: width 400ms linear 0s;
  }
  .view #progress-bar {
    display: none;
  }
</style>

<script>
  var Dz = {
    remoteWindows: [],
    idx: -1,
    step: 0,
    html: null,
    slides: null,
    progressBar : null,
    params: {
      autoplay: "1"
    }
  };

  Dz.init = function() {
    document.body.className = "loaded";
    this.slides = Array.prototype.slice.call($$("body > section"));
    this.progressBar = $("#progress-bar");
    this.html = document.body.parentNode;
    this.setupParams();
    this.onhashchange();
    this.setupTouchEvents();
    this.onresize();
    this.setupView();
  }

  Dz.setupParams = function() {
    var p = window.location.search.substr(1).split('&');
    p.forEach(function(e, i, a) {
      var keyVal = e.split('=');
      Dz.params[keyVal[0]] = decodeURIComponent(keyVal[1]);
    });
  // Specific params handling
    if (!+this.params.autoplay)
      $$.forEach($$("video"), function(v){ v.controls = true });
  }

  Dz.onkeydown = function(aEvent) {
    // Don't intercept keyboard shortcuts
    if (aEvent.altKey
      || aEvent.ctrlKey
      || aEvent.metaKey
      || aEvent.shiftKey) {
      return;
    }
    if ( aEvent.keyCode == 37 // left arrow
      || aEvent.keyCode == 38 // up arrow
      || aEvent.keyCode == 33 // page up
    ) {
      aEvent.preventDefault();
      this.back();
    }
    if ( aEvent.keyCode == 39 // right arrow
      || aEvent.keyCode == 40 // down arrow
      || aEvent.keyCode == 34 // page down
    ) {
      aEvent.preventDefault();
      this.forward();
    }
    if (aEvent.keyCode == 35) { // end
      aEvent.preventDefault();
      this.goEnd();
    }
    if (aEvent.keyCode == 36) { // home
      aEvent.preventDefault();
      this.goStart();
    }
    if (aEvent.keyCode == 32) { // space
      aEvent.preventDefault();
      this.toggleContent();
    }
    if (aEvent.keyCode == 70) { // f
      aEvent.preventDefault();
      this.goFullscreen();
    }
    if (aEvent.keyCode == 79) { // o
      aEvent.preventDefault();
      this.toggleView();
    }
  }

  /* Touch Events */

  Dz.setupTouchEvents = function() {
    var orgX, newX;
    var tracking = false;

    var db = document.body;
    db.addEventListener("touchstart", start.bind(this), false);
    db.addEventListener("touchmove", move.bind(this), false);

    function start(aEvent) {
      aEvent.preventDefault();
      tracking = true;
      orgX = aEvent.changedTouches[0].pageX;
    }

    function move(aEvent) {
      if (!tracking) return;
      newX = aEvent.changedTouches[0].pageX;
      if (orgX - newX > 100) {
        tracking = false;
        this.forward();
      } else {
        if (orgX - newX < -100) {
          tracking = false;
          this.back();
        }
      }
    }
  }

  Dz.setupView = function() {
    document.body.addEventListener("click", function ( e ) {
      if (!Dz.html.classList.contains("view")) return;
      if (!e.target || e.target.nodeName != "SECTION") return;

      Dz.html.classList.remove("view");
      Dz.setCursor(Dz.slides.indexOf(e.target) + 1);
    }, false);
  }

  /* Adapt the size of the slides to the window */

  Dz.onresize = function() {
    var db = document.body;
    var sx = db.clientWidth / window.innerWidth;
    var sy = db.clientHeight / window.innerHeight;
    var transform = "scale(" + (1/Math.max(sx, sy)) + ")";

    db.style.MozTransform = transform;
    db.style.WebkitTransform = transform;
    db.style.OTransform = transform;
    db.style.msTransform = transform;
    db.style.transform = transform;
  }


  Dz.getNotes = function(aIdx) {
    var s = $("section:nth-of-type(" + aIdx + ")");
    var d = s.$("[role='note']");
    return d ? d.innerHTML : "";
  }

  Dz.onmessage = function(aEvent) {
    var argv = aEvent.data.split(" "), argc = argv.length;
    argv.forEach(function(e, i, a) { a[i] = decodeURIComponent(e) });
    var win = aEvent.source;
    if (argv[0] === "REGISTER" && argc === 1) {
      this.remoteWindows.push(win);
      this.postMsg(win, "REGISTERED", document.title, this.slides.length);
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
      return;
    }
    if (argv[0] === "BACK" && argc === 1)
      this.back();
    if (argv[0] === "FORWARD" && argc === 1)
      this.forward();
    if (argv[0] === "START" && argc === 1)
      this.goStart();
    if (argv[0] === "END" && argc === 1)
      this.goEnd();
    if (argv[0] === "TOGGLE_CONTENT" && argc === 1)
      this.toggleContent();
    if (argv[0] === "SET_CURSOR" && argc === 2)
      window.location.hash = "#" + argv[1];
    if (argv[0] === "GET_CURSOR" && argc === 1)
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
    if (argv[0] === "GET_NOTES" && argc === 1)
      this.postMsg(win, "NOTES", this.getNotes(this.idx));
  }

  Dz.toggleContent = function() {
    // If a Video is present in this new slide, play it.
    // If a Video is present in the previous slide, stop it.
    var s = $("section[aria-selected]");
    if (s) {
      var video = s.$("video");
      if (video) {
        if (video.ended || video.paused) {
          video.play();
        } else {
          video.pause();
        }
      }
    }
  }

  Dz.setCursor = function(aIdx, aStep) {
    // If the user change the slide number in the URL bar, jump
    // to this slide.
    aStep = (aStep != 0 && typeof aStep !== "undefined") ? "." + aStep : ".0";
    window.location.hash = "#" + aIdx + aStep;
  }

  Dz.onhashchange = function() {
    var cursor = window.location.hash.split("#"),
        newidx = 1,
        newstep = 0;
    if (cursor.length == 2) {
      newidx = ~~cursor[1].split(".")[0];
      newstep = ~~cursor[1].split(".")[1];
      if (newstep > Dz.slides[newidx - 1].$$('.incremental > *').length) {
        newstep = 0;
        newidx++;
      }
    }
    this.setProgress(newidx, newstep);
    if (newidx != this.idx) {
      this.setSlide(newidx);
    }
    if (newstep != this.step) {
      this.setIncremental(newstep);
    }
    for (var i = 0; i < this.remoteWindows.length; i++) {
      this.postMsg(this.remoteWindows[i], "CURSOR", this.idx + "." + this.step);
    }
  }

  Dz.back = function() {
    if (this.idx == 1 && this.step == 0) {
      return;
    }
    if (this.step == 0) {
      this.setCursor(this.idx - 1,
                     this.slides[this.idx - 2].$$('.incremental > *').length);
    } else {
      this.setCursor(this.idx, this.step - 1);
    }
  }

  Dz.forward = function() {
    if (this.idx >= this.slides.length &&
        this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
        return;
    }
    if (this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
      this.setCursor(this.idx + 1, 0);
    } else {
      this.setCursor(this.idx, this.step + 1);
    }
  }

  Dz.goStart = function() {
    this.setCursor(1, 0);
  }

  Dz.goEnd = function() {
    var lastIdx = this.slides.length;
    var lastStep = this.slides[lastIdx - 1].$$('.incremental > *').length;
    this.setCursor(lastIdx, lastStep);
  }

  Dz.toggleView = function() {
    this.html.classList.toggle("view");

    if (this.html.classList.contains("view")) {
      $("section[aria-selected]").scrollIntoView(true);
    }
  }

  Dz.setSlide = function(aIdx) {
    this.idx = aIdx;
    var old = $("section[aria-selected]");
    var next = $("section:nth-of-type("+ this.idx +")");
    if (old) {
      old.removeAttribute("aria-selected");
      var video = old.$("video");
      if (video) {
        video.pause();
      }
    }
    if (next) {
      next.setAttribute("aria-selected", "true");
      if (this.html.classList.contains("view")) {
        next.scrollIntoView();
      }
      var video = next.$("video");
      if (video && !!+this.params.autoplay) {
        video.play();
      }
    } else {
      // That should not happen
      this.idx = -1;
      // console.warn("Slide doesn't exist.");
    }
  }

  Dz.setIncremental = function(aStep) {
    this.step = aStep;
    var old = this.slides[this.idx - 1].$('.incremental > *[aria-selected]');
    if (old) {
      old.removeAttribute('aria-selected');
    }
    var incrementals = $$('.incremental');
    if (this.step <= 0) {
      $$.forEach(incrementals, function(aNode) {
        aNode.removeAttribute('active');
      });
      return;
    }
    var next = this.slides[this.idx - 1].$$('.incremental > *')[this.step - 1];
    if (next) {
      next.setAttribute('aria-selected', true);
      next.parentNode.setAttribute('active', true);
      var found = false;
      $$.forEach(incrementals, function(aNode) {
        if (aNode != next.parentNode)
          if (found)
            aNode.removeAttribute('active');
          else
            aNode.setAttribute('active', true);
        else
          found = true;
      });
    } else {
      setCursor(this.idx, 0);
    }
    return next;
  }

  Dz.goFullscreen = function() {
    var html = $('html'),
        requestFullscreen = html.requestFullscreen || html.requestFullScreen || html.mozRequestFullScreen || html.webkitRequestFullScreen;
    if (requestFullscreen) {
      requestFullscreen.apply(html);
    }
  }
  
  Dz.setProgress = function(aIdx, aStep) {
    var slide = $("section:nth-of-type("+ aIdx +")");
    if (!slide)
      return;
    var steps = slide.$$('.incremental > *').length + 1,
        slideSize = 100 / (this.slides.length - 1),
        stepSize = slideSize / steps;
    this.progressBar.style.width = ((aIdx - 1) * slideSize + aStep * stepSize) + '%';
  }
  
  Dz.postMsg = function(aWin, aMsg) { // [arg0, [arg1...]]
    aMsg = [aMsg];
    for (var i = 2; i < arguments.length; i++)
      aMsg.push(encodeURIComponent(arguments[i]));
    aWin.postMessage(aMsg.join(" "), "*");
  }
  
  function init() {
    Dz.init();
    window.onkeydown = Dz.onkeydown.bind(Dz);
    window.onresize = Dz.onresize.bind(Dz);
    window.onhashchange = Dz.onhashchange.bind(Dz);
    window.onmessage = Dz.onmessage.bind(Dz);
  }

  window.onload = init;
</script>


<script> // Helpers
  if (!Function.prototype.bind) {
    Function.prototype.bind = function (oThis) {

      // closest thing possible to the ECMAScript 5 internal IsCallable
      // function 
      if (typeof this !== "function")
      throw new TypeError(
        "Function.prototype.bind - what is trying to be fBound is not callable"
      );

      var aArgs = Array.prototype.slice.call(arguments, 1),
          fToBind = this,
          fNOP = function () {},
          fBound = function () {
            return fToBind.apply( this instanceof fNOP ? this : oThis || window,
                   aArgs.concat(Array.prototype.slice.call(arguments)));
          };

      fNOP.prototype = this.prototype;
      fBound.prototype = new fNOP();

      return fBound;
    };
  }

  var $ = (HTMLElement.prototype.$ = function(aQuery) {
    return this.querySelector(aQuery);
  }).bind(document);

  var $$ = (HTMLElement.prototype.$$ = function(aQuery) {
    return this.querySelectorAll(aQuery);
  }).bind(document);

  $$.forEach = function(nodeList, fun) {
    Array.prototype.forEach.call(nodeList, fun);
  }

</script>
<!-- vim: set fdm=marker: }}} -->
